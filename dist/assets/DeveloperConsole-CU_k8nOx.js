import{r,j as e,a4 as J,an as Q,i as x,a5 as V,z as W,a as L,a3 as Z,T as q,X as ee,x as te,w as ae,b as se,a6 as ie,d as o,t as p,c as v}from"./index-CcQVG4nr.js";import{L as le}from"./Layout-aA6jRwwe.js";const de=({onBack:U})=>{const[ne,re]=r.useState("explorer"),[s,M]=r.useState("users"),[u,N]=r.useState([]),[I,S]=r.useState(!0),[C,D]=r.useState([]),[P,m]=r.useState(!1),[_,y]=r.useState(!1),[F,T]=r.useState(""),[K,g]=r.useState([]),[c,f]=r.useState(null),[A,O]=r.useState(!1),B=["users","students","teachers","attendance","claim_requests","letters","journals","assignments","discipline_logs","violations_master","classes","academic_years","settings","about_content","login_logs","audit_logs"],n=(t,a="info")=>{const l={info:">>",success:"[OK]",warn:"[!]",error:"[ERR]"}[a];D(i=>[`${l} ${new Date().toLocaleTimeString()}: ${t}`,...i].slice(0,30))},w=async t=>{if(S(!0),n(`Sinkronisasi Koleksi: ${t.toUpperCase()}`),x){setTimeout(()=>{N([{id:"mock_1",name:`DATA_${t}_SIMULASI`,status:"Active",updated:new Date().toISOString()}]),S(!1)},400);return}if(o)try{const a=await o.collection(t).limit(100).get(),l=a.docs.map(i=>({id:i.id,...i.data()}));N(l),n(`Koleksi ${t} dimuat. Total: ${a.size} Entri`,"success")}catch(a){n(`Gagal memuat ${t}: ${a.message}`,"error"),p.error("Security Rules: Akses ditolak")}finally{S(!1)}};r.useEffect(()=>{w(s)},[s]);const z=async t=>{var a,l,i,k,R,$;t.preventDefault(),O(!0);try{if(!o&&!x)throw new Error("Database belum siap");const{id:h,...b}=c||{},d=s==="users"&&b.uid||h;if(!d&&!x&&h!==void 0)throw new Error("ID Dokumen tidak valid");if(x){await new Promise(E=>setTimeout(E,1e3)),n(`MOCK_WRITE: ${s}/${d||"new"}`,"success"),p.success("Simulasi Simpan Berhasil"),m(!1);return}if(d)await o.collection(s).doc(d).set({...b,updatedAt:new Date().toISOString(),updatedBy:((l=(a=v)==null?void 0:a.currentUser)==null?void 0:l.uid)||"dev_console"},{merge:!0}),n(`UPDATED: ${s}/${d}`,"success");else{const E=await o.collection(s).add({...b,createdAt:new Date().toISOString(),createdBy:((k=(i=v)==null?void 0:i.currentUser)==null?void 0:k.uid)||"dev_console"});n(`INJECTED: ${s}/${E.id}`,"success")}s==="users"&&b.studentId&&(await o.collection("students").doc(b.studentId).update({accountStatus:"Active",linkedUserId:d,updatedAt:new Date().toISOString()}),n(`RELATION_SYNC: Student linked to UID ${d}`,"info")),await o.collection("audit_logs").add({action:d?"UPDATE":"CREATE",collection:s,docId:d||"new",timestamp:new Date().toISOString(),actor:(($=(R=v)==null?void 0:R.currentUser)==null?void 0:$.email)||"system_dev"}),p.success("Database Terupdate"),m(!1),w(s)}catch(h){n(`OPERATIONAL_FAILURE: ${h.message}`,"error"),p.error(h.message)}finally{O(!1)}},G=async t=>{var a,l;if(window.confirm(`Hapus permanen ${s}/${t.id}?
Tindakan ini tidak dapat dibatalkan.`))try{if(!o&&!x)throw new Error("Database Offline");if(x){await new Promise(i=>setTimeout(i,600)),n(`MOCK_DELETE: ${t.id}`,"warn"),p.success("Simulasi Hapus Berhasil"),N(i=>i.filter(k=>k.id!==t.id));return}s==="users"&&t.studentId&&(await o.collection("students").doc(t.studentId).update({accountStatus:"Unlinked",linkedUserId:null,updatedAt:new Date().toISOString()}),n(`CLEANUP: Student link removed for ${t.studentId}`,"warn")),await o.collection(s).doc(t.id).delete(),n(`DELETED: ${s}/${t.id}`,"warn"),await o.collection("audit_logs").add({action:"DELETE",collection:s,docId:t.id,timestamp:new Date().toISOString(),actor:((l=(a=v)==null?void 0:a.currentUser)==null?void 0:l.email)||"system_dev"}),p.success("Data Berhasil Dihapus"),w(s)}catch(i){n(`DELETE_ERROR: ${i.message}`,"error"),p.error(i.message)}},H=async t=>{if(t.length<3){g([]);return}if(n(`Searching master identity: ${t.toUpperCase()}...`),x){g([{id:"s_01",namaLengkap:"SIMULASI_USER",nisn:"001",tingkatRombel:"X"}]);return}try{const l=(await o.collection("students").where("status","==","Aktif").get()).docs.map(i=>({id:i.id,...i.data()})).filter(i=>(i.namaLengkap||"").toLowerCase().includes(t.toLowerCase())||(i.nisn||"").includes(t));g(l)}catch{}},X=t=>{f({uid:t.nisn,displayName:t.namaLengkap,email:`${t.nisn}@madrasah.id`,role:"siswa",idUnik:t.idUnik||t.nisn,studentId:t.id,class:t.tingkatRombel,status:"Active"}),y(!1),n(`Identitas ${t.namaLengkap} disiapkan.`,"success")},Y=()=>{y(s==="users"),T(""),g([]);let t={};s==="users"?t={uid:"",displayName:"",email:"",role:"siswa",idUnik:"",status:"Active"}:u.length>0?Object.keys(u[0]).forEach(a=>{a!=="id"&&(t[a]="")}):t={name:"",description:"",status:"Active"},f(t),m(!0)},j=r.useMemo(()=>{if(u.length===0)return["id"];const t=new Set;return u.slice(0,10).forEach(a=>Object.keys(a).forEach(l=>t.add(l))),Array.from(t).slice(0,12)},[u]);return e.jsx(le,{title:"Dev Console",subtitle:"v6.7.0 - Root Data Control",icon:J,onBack:U,children:e.jsxs("div",{className:"p-4 lg:p-8 pb-32 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-[#0F172A] rounded-[2.5rem] p-6 text-white border border-white/5 shadow-2xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-[0.03] -rotate-12",children:e.jsx(Q,{className:"w-48 h-48"})}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-emerald-500 shadow-[0_0_15px_#10b981]"}),e.jsxs("p",{className:"text-[9px] font-black uppercase tracking-[0.5em] text-slate-500",children:["Kernel: ",x?"MOCK_ENGINE":"LIVE_FIRESTORE"]})]}),e.jsxs("h2",{className:"text-3xl font-black tracking-tighter uppercase italic",children:["REGISTRY_",s.toUpperCase()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Y,className:"px-6 py-4 bg-emerald-600 hover:bg-emerald-500 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-xl transition-all flex items-center gap-3 active:scale-95",children:[e.jsx(V,{className:"w-5 h-5"}),"New Entry"]}),e.jsx("button",{onClick:()=>w(s),className:"p-4 bg-white/5 hover:bg-white/10 rounded-2xl border border-white/10 transition-all active:rotate-180 duration-500",children:e.jsx(W,{className:`w-6 h-6 ${I?"animate-spin":""}`})})]})]})]}),e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800/50 p-1.5 rounded-[1.8rem] flex overflow-x-auto gap-1 scrollbar-hide border border-slate-200 dark:border-slate-800 shadow-inner",children:B.map(t=>e.jsx("button",{onClick:()=>M(t),className:`px-5 py-2.5 rounded-2xl text-[9px] font-black uppercase tracking-wider whitespace-nowrap transition-all flex items-center gap-2 ${s===t?"bg-indigo-600 text-white shadow-xl scale-105":"text-slate-400 hover:text-indigo-600"}`,children:t.replace("_"," ")},t))}),e.jsx("div",{className:"animate-in fade-in duration-700",children:e.jsx("div",{className:"bg-white dark:bg-[#151E32] rounded-[3rem] border border-slate-100 dark:border-slate-800 shadow-2xl overflow-hidden flex flex-col min-h-[400px]",children:e.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:e.jsxs("table",{className:"excel-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[j.map(t=>e.jsx("th",{className:"bg-slate-50 dark:bg-slate-800/80 text-[7.5px] py-3 px-4 font-black uppercase tracking-widest border-r border-slate-100 dark:border-slate-700",children:t},t)),e.jsx("th",{className:"text-center w-24 bg-slate-100 dark:bg-slate-800 text-[7.5px] font-black uppercase text-indigo-600",children:"Ops"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50 dark:divide-slate-800",children:I?e.jsx("tr",{children:e.jsx("td",{colSpan:j.length+1,className:"py-40 text-center",children:e.jsx(L,{className:"w-12 h-12 animate-spin mx-auto text-indigo-500 opacity-20"})})}):u.length>0?u.map((t,a)=>e.jsxs("tr",{className:"group hover:bg-indigo-50/20 dark:hover:bg-indigo-900/10 transition-colors",children:[j.map(l=>e.jsx("td",{className:"truncate max-w-[150px] font-mono text-[9px] py-3.5 px-4 text-slate-500 dark:text-slate-400 border-r border-transparent",children:typeof t[l]=="object"?"{Object}":String(t[l]||"-")},l)),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>{f({...t}),m(!0)},className:"p-2 rounded-xl bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 hover:bg-indigo-600 hover:text-white transition-all shadow-sm",children:e.jsx(Z,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>G(t),className:"p-2 rounded-xl bg-rose-50 dark:bg-rose-900/30 text-rose-600 hover:bg-rose-600 hover:text-white transition-all shadow-sm",children:e.jsx(q,{className:"w-3.5 h-3.5"})})]})})]},t.id||a)):e.jsx("tr",{children:e.jsx("td",{colSpan:j.length+1,className:"py-32 text-center text-slate-300 font-black uppercase text-[10px] tracking-[0.5em] italic",children:"No Entries Found"})})})]})})})}),e.jsxs("div",{className:"bg-[#020617] rounded-[2.5rem] overflow-hidden border border-white/5 shadow-2xl",children:[e.jsxs("div",{className:"bg-slate-900/50 px-6 py-4 flex items-center justify-between border-b border-white/5",children:[e.jsxs("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"}),"Operational Debugger"]}),e.jsx("button",{onClick:()=>D([]),className:"text-[9px] font-black text-indigo-400 uppercase hover:text-white transition-colors",children:"Clear"})]}),e.jsx("div",{className:"h-40 overflow-y-auto p-5 font-mono text-[9px] space-y-1.5 custom-scrollbar bg-black/40",children:C.length>0?C.map((t,a)=>e.jsx("p",{className:`leading-none ${t.includes("[ERR]")?"text-rose-400":t.includes("[OK]")?"text-emerald-400":t.includes("[!]")?"text-amber-400":"text-slate-500"}`,children:t},a)):e.jsx("p",{className:"text-slate-800 italic uppercase",children:"Terminal idle..."})})]}),P&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md",children:e.jsxs("div",{className:"bg-white dark:bg-[#0B1121] w-full max-w-2xl rounded-[3rem] shadow-2xl overflow-hidden border border-white/10 animate-in zoom-in duration-300 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-white dark:bg-[#0B1121]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-black text-slate-800 dark:text-white uppercase leading-none italic",children:_?"RELATION_INJECT_PROCESS":c!=null&&c.id?"SCHEMA_MODIFICATION":"NEW_ENTRY_REGISTER"}),e.jsxs("p",{className:"text-[10px] font-bold text-indigo-600 mt-2 uppercase tracking-widest",children:["Target: ",s]})]}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 rounded-full hover:bg-slate-100 text-slate-400 transition-colors",children:e.jsx(ee,{className:"w-8 h-8"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:_?e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"p-6 bg-indigo-600 rounded-3xl text-white shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(te,{className:"w-24 h-24"})}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest mb-4",children:"Cari Master Database:"}),e.jsxs("div",{className:"relative group",children:[e.jsx(ae,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-indigo-300"}),e.jsx("input",{type:"text",autoFocus:!0,value:F,onChange:t=>{T(t.target.value),H(t.target.value)},className:"w-full bg-white/10 border border-white/20 rounded-2xl py-4 pl-12 pr-4 text-sm font-bold text-white placeholder-indigo-300 outline-none focus:bg-white/20 transition-all",placeholder:"Nama atau NISN..."})]})]}),e.jsx("div",{className:"space-y-2",children:K.map(t=>e.jsxs("button",{onClick:()=>X(t),className:"w-full p-4 bg-slate-50 dark:bg-slate-900 rounded-2xl border border-slate-100 dark:border-slate-800 flex items-center justify-between group hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-all",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("h5",{className:"text-[11px] font-black text-slate-800 dark:text-white uppercase leading-none",children:t.namaLengkap}),e.jsxs("p",{className:"text-[9px] text-slate-400 font-bold uppercase mt-1",children:["ID: ",t.nisn," â€¢ Rombel: ",t.tingkatRombel]})]}),e.jsx(se,{className:"w-5 h-5 text-indigo-600 opacity-0 group-hover:opacity-100 transition-all"})]},t.id))}),e.jsx("button",{onClick:()=>y(!1),className:"w-full py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-indigo-600 transition-colors",children:"Lewati & Manual Input"})]}):e.jsxs("form",{onSubmit:z,className:"p-8 space-y-5",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:Object.keys(c||{}).filter(t=>t!=="id").map(t=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-1",children:t}),e.jsx("input",{type:"text",value:c[t]||"",onChange:a=>f({...c,[t]:a.target.value}),className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl py-3.5 px-5 text-[11px] font-bold outline-none focus:ring-4 focus:ring-indigo-500/10 shadow-inner",placeholder:`Value for ${t}`})]},t))}),e.jsxs("div",{className:"pt-8 flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 py-4 bg-slate-100 dark:bg-slate-800 text-slate-500 font-black rounded-2xl text-[10px] uppercase tracking-widest active:scale-95 transition-all",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:A,className:"flex-[2] bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-2xl flex items-center justify-center gap-3 active:scale-[0.98] transition-all disabled:opacity-50",children:[A?e.jsx(L,{className:"w-5 h-5 animate-spin"}):e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"text-[10px] uppercase tracking-[0.2em]",children:c!=null&&c.id?"Confirm Modification":"Inject Database"})]})]})]})})]})})]})})};export{de as default};
