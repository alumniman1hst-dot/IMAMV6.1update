import{r as l,j as e,S as K,C as p,z,m as O,as as D,X as b,at as A,a as N,o as G,p as $,I as q,e as F,O as H,x as V,au as R,t as d,d as L}from"./index-CcQVG4nr.js";import{L as X}from"./Layout-aA6jRwwe.js";import{a as J,b as Q,d as W,r as Y}from"./claimService-5F3p9bVQ.js";const ae=({onBack:u})=>{const[i,g]=l.useState("pending"),[r,o]=l.useState([]),[w,v]=l.useState(!0),[j,x]=l.useState(null),[s,m]=l.useState(null),[t,y]=l.useState(null),[T,I]=l.useState(!1),[E,k]=l.useState(!1),[f,C]=l.useState(""),h=async()=>{v(!0);try{const n=await J(i==="log"?"all":i);o(n)}catch{d.error("Gagal sinkronisasi data klaim.")}finally{v(!1)}};l.useEffect(()=>{h()},[i]);const P=async a=>{m(a),I(!0),y(null);try{if(a.status==="pending"&&await Q(a.id),L){const n=a.type==="siswa"?"students":"teachers",B=a.targetId,S=await L.collection(n).doc(B).get();S.exists&&y(S.data())}}catch{d.error("Gagal memproses validasi otomatis.")}finally{I(!1)}},M=async()=>{if(!(!s||!window.confirm(`Sahkan identitas digital untuk ${s.userName}?`))){x(s.id);try{await W(s),d.success("Klaim Disetujui. Hak akses user ditingkatkan."),m(null),h()}catch(a){d.error(a.message||"Gagal memproses persetujuan.")}finally{x(null)}}},U=async()=>{if(!(!s||!f)){x(s.id);try{await Y(s.id,f),d.info("Pengajuan telah ditolak."),k(!1),C(""),m(null),h()}catch{d.error("Gagal mengirim keputusan penolakan.")}finally{x(null)}}};return e.jsx(X,{title:"Manajemen Klaim",subtitle:"Otoritas Identitas Digital",icon:K,onBack:u,children:e.jsxs("div",{className:"p-4 lg:p-8 pb-32 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 animate-in fade-in duration-700",children:[e.jsxs("div",{className:"bg-indigo-600 rounded-[2rem] p-6 text-white shadow-xl",children:[e.jsx("h4",{className:"text-3xl font-black",children:r.filter(a=>a.status==="pending").length}),e.jsx("p",{className:"text-[9px] font-bold uppercase tracking-widest opacity-70 mt-1",children:"Pending Request"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#151E32] rounded-[2rem] p-6 border border-slate-100 dark:border-slate-800 shadow-sm",children:[e.jsx("h4",{className:"text-3xl font-black text-amber-500",children:r.filter(a=>a.status==="reviewing").length}),e.jsx("p",{className:"text-[9px] font-bold uppercase tracking-widest text-slate-400 mt-1",children:"Sedang Ditinjau"})]}),e.jsxs("div",{className:"bg-white dark:bg-[#151E32] rounded-[2rem] p-6 border border-slate-100 dark:border-slate-800 shadow-sm md:col-span-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-emerald-50 text-emerald-600 flex items-center justify-center",children:e.jsx(p,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest leading-none",children:"Status Autentikasi"}),e.jsx("h4",{className:"text-sm font-black text-emerald-600 uppercase mt-1",children:"Sistem Aktif"})]})]}),e.jsx("button",{onClick:h,className:"p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl hover:bg-indigo-50 transition-all border border-slate-100 dark:border-slate-700",children:e.jsx(z,{className:`w-5 h-5 ${w?"animate-spin":""}`})})]})]}),e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800/50 p-1.5 rounded-[1.8rem] flex overflow-x-auto gap-1 border border-slate-200 dark:border-slate-800 shadow-inner scrollbar-hide",children:[{id:"pending",label:"Menunggu",icon:O},{id:"reviewing",label:"Ditinjau",icon:D},{id:"approved",label:"Disetujui",icon:p},{id:"rejected",label:"Ditolak",icon:b},{id:"log",label:"Log Aktivitas",icon:A}].map(a=>e.jsxs("button",{onClick:()=>g(a.id),className:`px-6 py-2.5 rounded-xl text-[9px] font-black uppercase tracking-wider flex items-center gap-2 transition-all whitespace-nowrap ${i===a.id?"bg-white dark:bg-slate-700 text-indigo-600 shadow-lg":"text-slate-400 hover:text-indigo-600"}`,children:[e.jsx(a.icon,{className:"w-3.5 h-3.5"}),a.label]},a.id))}),e.jsx("div",{className:"bg-white dark:bg-[#151E32] rounded-[2.5rem] border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden flex flex-col min-h-[400px]",children:e.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:e.jsxs("table",{className:"excel-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center w-12",children:"No"}),e.jsx("th",{children:"Nama Akun"}),e.jsx("th",{className:"text-center",children:"Tipe"}),e.jsx("th",{className:"text-center",children:"ID Tujuan"}),e.jsx("th",{className:"text-center",children:"Tgl Masuk"}),e.jsx("th",{className:"text-center w-32",children:"Aksi"})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-32 text-center",children:e.jsx(N,{className:"w-10 h-10 animate-spin mx-auto text-indigo-500 opacity-20"})})}):r.length>0?r.map((a,n)=>e.jsxs("tr",{className:"group hover:bg-indigo-50/50 dark:hover:bg-indigo-900/10",children:[e.jsx("td",{className:"text-center font-mono text-slate-400 font-bold",children:n+1}),e.jsx("td",{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-black text-slate-800 dark:text-slate-200 uppercase tracking-tight",children:a.userName}),e.jsx("span",{className:"text-[9px] text-slate-400 font-medium",children:a.userEmail})]})}),e.jsx("td",{className:"text-center",children:e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-lg text-[8px] font-black uppercase tracking-widest ${a.type==="siswa"?"bg-teal-50 text-teal-600":"bg-indigo-50 text-indigo-600"}`,children:[a.type==="siswa"?e.jsx(G,{className:"w-3 h-3"}):e.jsx($,{className:"w-3 h-3"}),a.type]})}),e.jsx("td",{className:"text-center font-mono font-black text-indigo-600 dark:text-indigo-400",children:a.targetId}),e.jsx("td",{className:"text-center text-[10px] text-slate-400 font-bold",children:new Date(a.createdAt).toLocaleDateString("id-ID")}),e.jsx("td",{className:"text-center",children:e.jsx("button",{onClick:()=>P(a),className:"p-2.5 rounded-xl bg-slate-50 dark:bg-slate-800 text-slate-500 hover:bg-indigo-600 hover:text-white transition-all border border-slate-100 dark:border-slate-700",children:e.jsx(D,{className:"w-4.5 h-4.5"})})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-32 text-center text-[10px] font-black text-slate-400 uppercase tracking-[0.4em] italic",children:"Tidak ada pengajuan dalam daftar"})})})]})})}),s&&e.jsx("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md",children:e.jsxs("div",{className:"bg-white dark:bg-[#0B1121] w-full max-w-5xl rounded-[3rem] shadow-2xl overflow-hidden border border-white/10 animate-in zoom-in duration-300 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-white dark:bg-[#0B1121]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-indigo-600 flex items-center justify-center text-white shadow-lg",children:e.jsx(A,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-black text-slate-800 dark:text-white uppercase leading-none",children:"Audit Identitas Digital"}),e.jsxs("p",{className:"text-[10px] font-bold text-indigo-600 mt-2 uppercase tracking-widest",children:["ID: ",s.targetId]})]})]}),e.jsx("button",{onClick:()=>m(null),className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400",children:e.jsx(b,{className:"w-8 h-8"})})]}),e.jsxs("div",{className:"px-8 py-4 bg-amber-50 dark:bg-amber-900/10 border-b border-amber-100 dark:border-amber-900/30 flex items-center gap-4",children:[e.jsx(q,{className:"w-5 h-5 text-amber-600 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-amber-700 dark:text-amber-300 uppercase tracking-widest leading-none",children:"Instruksi Verifikasi (SOP):"}),e.jsx("p",{className:"text-[9px] text-amber-600 dark:text-amber-400 mt-1 font-medium",children:"Bandingkan Nama di Akun (Kiri) dengan Nama Terdaftar di Database (Kanan). Pastikan status profil belum diklaim orang lain."})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar",children:T?e.jsx("div",{className:"py-20 text-center",children:e.jsx(N,{className:"w-10 h-10 animate-spin mx-auto text-indigo-500"})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"})," 1. Identitas Akun User"]}),e.jsxs("div",{className:"p-6 bg-slate-50 dark:bg-slate-900 rounded-[2rem] border border-slate-100 dark:border-slate-800 space-y-4 shadow-inner",children:[e.jsx(c,{label:"Nama Pengguna",value:s.userName}),e.jsx(c,{label:"Alamat Email",value:s.userEmail}),e.jsx(c,{label:"Auth UID",value:s.userId,isMono:!0})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"})," 2. Referensi Database Sekolah"]}),t?e.jsxs("div",{className:"p-6 bg-emerald-50/50 dark:bg-emerald-950/20 rounded-[2rem] border border-emerald-100 dark:border-emerald-900/50 space-y-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4",children:e.jsx(V,{className:"w-12 h-12 text-emerald-500 opacity-20"})}),e.jsx(c,{label:"Nama Di Database",value:t.namaLengkap||t.name,highlight:s.userName.toLowerCase()===(t.namaLengkap||t.name).toLowerCase()}),e.jsx(c,{label:"Status Kepemilikan",value:t.isClaimed?"SUDAH TERKUNCI":"TERSEDIA UNTUK KLAIM",warning:t.isClaimed}),t.isClaimed&&e.jsxs("div",{className:"mt-4 p-4 bg-rose-50 dark:bg-rose-900/30 border border-rose-100 rounded-2xl flex items-start gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-rose-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-[9px] font-bold text-rose-700 uppercase",children:"Perhatian: Profil ini sudah dimiliki akun lain!"}),e.jsxs("p",{className:"text-[8px] font-mono text-rose-600 mt-1 break-all",children:["Linked AuthUID: ",t.authUid||"N/A"]})]})]})]}):e.jsxs("div",{className:"p-10 bg-rose-50 dark:bg-rose-900/20 rounded-[2rem] border border-rose-100 text-center flex flex-col items-center gap-3",children:[e.jsx(b,{className:"w-12 h-12 text-rose-500 opacity-30"}),e.jsx("p",{className:"text-[10px] font-black text-rose-600 uppercase tracking-widest italic",children:"ID Tidak Ditemukan di Master"})]})]})]})}),e.jsx("div",{className:"p-8 border-t border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-[#0B1121] flex flex-col md:flex-row gap-4 items-center",children:e.jsxs("div",{className:"flex-1 w-full flex gap-3",children:[e.jsxs("button",{disabled:!!j,onClick:()=>k(!0),className:"flex-1 py-4.5 bg-white dark:bg-slate-800 text-rose-600 font-black rounded-[2rem] border border-rose-100 text-[10px] uppercase tracking-[0.2em] shadow-lg active:scale-95 transition-all flex items-center justify-center gap-3",children:[e.jsx(b,{className:"w-5 h-5"})," Tolak Pengajuan"]}),e.jsxs("button",{disabled:!!j||!t||t.isClaimed,onClick:M,className:"flex-[1.5] py-4.5 bg-indigo-600 hover:bg-indigo-700 text-white font-black rounded-[2rem] text-[10px] uppercase tracking-[0.3em] shadow-2xl shadow-indigo-500/30 transition-all flex items-center justify-center gap-3 active:scale-[0.98] disabled:opacity-50",children:[j===s.id?e.jsx(N,{className:"w-5 h-5 animate-spin"}):e.jsx(p,{className:"w-5 h-5"}),"Validasi & Hubungkan Akun"]})]})})]})}),E&&e.jsx("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md",children:e.jsxs("div",{className:"bg-white dark:bg-[#0B1121] w-full max-w-md rounded-[3rem] p-8 shadow-2xl animate-in zoom-in duration-300 border border-white/10",children:[e.jsx("h3",{className:"text-xl font-black text-slate-800 dark:text-white uppercase mb-2",children:"Alasan Penolakan"}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-6",children:"Pesan ini akan dikirim ke user melalui sistem"}),e.jsx("textarea",{value:f,onChange:a=>C(a.target.value),placeholder:"Contoh: Nama tidak sesuai dengan data NISN...",className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 rounded-[1.8rem] p-5 text-xs font-bold focus:ring-4 focus:ring-indigo-500/10 outline-none h-32 resize-none shadow-inner"}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsx("button",{onClick:()=>k(!1),className:"flex-1 py-4 bg-slate-100 dark:bg-slate-800 rounded-2xl text-slate-500 font-black text-[10px] uppercase tracking-widest",children:"Batal"}),e.jsx("button",{onClick:U,className:"flex-[2] py-4 bg-rose-600 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-rose-500/20",children:"Kirim Penolakan"})]})]})})]})})},c=({label:u,value:i,isMono:g=!1,highlight:r=!1,warning:o=!1})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[8px] font-black text-slate-400 uppercase tracking-widest ml-1",children:u}),e.jsxs("div",{className:`px-4 py-2.5 rounded-xl text-[11px] font-bold flex items-center justify-between ${r?"bg-emerald-100 text-emerald-700 border border-emerald-200":o?"bg-rose-100 text-rose-700 border border-rose-200 animate-pulse":"bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 shadow-sm"}`,children:[e.jsx("span",{className:g?"font-mono":"",children:i}),r&&e.jsx(p,{className:"w-3.5 h-3.5"}),o&&e.jsx(R,{className:"w-3.5 h-3.5"})]})]});export{ae as default};
