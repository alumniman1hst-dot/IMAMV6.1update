import{r,i as C,c as A,d as f,e as L,p as O,g as Q,S as T,j as e,a as b,x as W,m as X,b as F,W as H,Y as J,X as Y,C as U,t as M}from"./index-CcQVG4nr.js";import{g as Z,c as _,s as ee}from"./claimService-5F3p9bVQ.js";import{L as ae}from"./Layout-aA6jRwwe.js";import{Q as se}from"./index-DPVcr-rT.js";const ne=({onBack:R,onLogout:D})=>{var I,S;const[s,k]=r.useState(null),[K,p]=r.useState(!0),[P,G]=r.useState([]),[V,g]=r.useState(!1),[l,w]=r.useState("siswa"),[m,$]=r.useState(""),[x,z]=r.useState(""),[N,j]=r.useState(!1),[n,c]=r.useState({found:!1,data:null,checking:!1});r.useEffect(()=>{const a=l==="siswa"?10:8;if(m.length<a){c({found:!1,data:null,checking:!1});return}const d=setTimeout(async()=>{var t;c(o=>({...o,checking:!0}));try{if(C){await new Promise(B=>setTimeout(B,600)),c({found:!0,data:{name:"DATA MASTER DITEMUKAN",idUnik:"999"},checking:!1});return}const o=l==="siswa"?"students":"teachers",h=await f.collection(o).doc(m.trim()).get();h.exists&&!((t=h.data())!=null&&t.isClaimed)?c({found:!0,data:h.data(),checking:!1}):c({found:!1,data:null,checking:!1})}catch{c({found:!1,data:null,checking:!1})}},500);return()=>clearTimeout(d)},[m,l]);const v=a=>`w-full bg-slate-50 dark:bg-slate-900 border rounded-2xl py-4 px-6 text-sm font-bold outline-none transition-all duration-300 ${a?"border-emerald-500 bg-emerald-50 text-emerald-900 focus:ring-4 focus:ring-emerald-500/10":"border-slate-100 dark:border-slate-700 focus:ring-4 focus:ring-indigo-500/10"}`;r.useEffect(()=>{y()},[]);const y=async()=>{var a;if(p(!0),C){setTimeout(()=>{k({uid:"mock-user-123",displayName:"User Simulasi",email:"user@imam.sch.id",role:"Tamu",phone:"081234567890",address:"Jl. Merdeka, Barabai",createdAt:new Date().toISOString(),claimVerified:!1}),p(!1)},800);return}if((a=A)!=null&&a.currentUser){const i=A.currentUser;try{if(f){const d=await f.collection("users").doc(i.uid).get();if(d.exists){const t=d.data(),o=await Z();G(o),k({uid:i.uid,displayName:(t==null?void 0:t.displayName)||i.displayName||"Pengguna",email:i.email||"",role:(t==null?void 0:t.role)||"Tamu",photoURL:i.photoURL||void 0,claimVerified:(t==null?void 0:t.claimVerified)||!1,...t})}}}catch(d){console.error(d)}}p(!1)},E=async a=>{if(a.preventDefault(),!!n.found){j(!0);try{const i=l==="guru"?_(x).toUpperCase():x.trim();await ee(l,m.trim(),i),M.success("Pengajuan terkirim! Admin akan memvalidasi data Anda."),g(!1),y()}catch(i){M.error(i.message||"Gagal mengirim pengajuan.")}finally{j(!1)}}},u=q((s==null?void 0:s.role)||"Tamu");function q(a){switch(String(a).toUpperCase()){case"ADMIN":return{label:"Administrator",icon:T,gradient:"from-rose-500 to-red-600",bgLight:"bg-rose-50",text:"text-rose-600"};case"SISWA":return{label:"Siswa Terverifikasi",icon:Q,gradient:"from-teal-400 to-emerald-600",bgLight:"bg-teal-50",text:"text-teal-600"};case"GURU":return{label:"Guru / GTK",icon:O,gradient:"from-indigo-500 to-blue-600",bgLight:"bg-indigo-50",text:"text-indigo-600"};default:return{label:"Tamu (Guest)",icon:L,gradient:"from-slate-400 to-slate-600",bgLight:"bg-slate-50",text:"text-slate-600"}}}return e.jsx(ae,{title:"Profil Saya",subtitle:"Identitas & Kontrol Akses",icon:L,onBack:R,children:e.jsxs("div",{className:"p-4 lg:p-8 pb-32 max-w-4xl mx-auto w-full space-y-6",children:[K?e.jsx("div",{className:"py-20 text-center",children:e.jsx(b,{className:"w-10 h-10 animate-spin mx-auto text-indigo-500"})}):s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative overflow-hidden rounded-[2.5rem] bg-white dark:bg-slate-800 shadow-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:`absolute top-0 inset-x-0 h-32 bg-gradient-to-r ${u.gradient}`}),e.jsxs("div",{className:"relative pt-16 px-6 pb-6 flex flex-col md:flex-row items-center md:items-end gap-6",children:[e.jsx("div",{className:"w-28 h-28 rounded-full p-1 bg-white dark:bg-slate-800 shadow-xl relative -mt-4 overflow-hidden",children:e.jsx("div",{className:"w-full h-full rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center",children:s.photoURL?e.jsx("img",{src:s.photoURL,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-3xl font-black text-slate-300",children:s.displayName[0]})})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-xl font-black text-slate-800 dark:text-white uppercase tracking-tight",children:s.displayName}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:s.email})]}),e.jsx("div",{className:`px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-widest border ${u.bgLight} ${u.text}`,children:u.label})]})]}),!s.claimVerified&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-indigo-600 rounded-[2rem] p-6 text-white shadow-xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-10 rotate-12",children:e.jsx(T,{className:"w-32 h-32"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("h3",{className:"text-sm font-black uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-yellow-300"})," Aktifkan Akun Madrasah"]}),e.jsx("p",{className:"text-xs text-indigo-100 leading-relaxed mb-6 opacity-90",children:"Akun Anda saat ini memiliki akses terbatas. Hubungkan dengan database resmi madrasah untuk membuka seluruh fitur."}),P.find(a=>a.status==="pending"||a.status==="reviewing")?e.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-2xl flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-yellow-300 animate-pulse"}),e.jsx("p",{className:"text-[10px] font-black text-yellow-300 uppercase tracking-widest",children:"Menunggu Validasi Admin..."})]}):e.jsxs("button",{onClick:()=>g(!0),className:"px-8 py-3.5 bg-white text-indigo-600 rounded-2xl font-black text-[10px] uppercase tracking-[0.2em] shadow-lg active:scale-95 transition-all flex items-center gap-3",children:["Mulai Klaim Sekarang ",e.jsx(F,{className:"w-4 h-4"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-[2rem] border border-slate-100 dark:border-slate-700 shadow-sm",children:[e.jsx("h4",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest mb-4",children:"Informasi Akun"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-900 rounded-xl",children:[e.jsx(H,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:"text-[11px] font-bold text-slate-700 dark:text-slate-300",children:["ID: ",s.idUnik||"-"]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-900 rounded-xl",children:[e.jsx(J,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-[11px] font-bold text-slate-700 dark:text-slate-300 truncate",children:s.address||"Alamat belum diatur"})]})]})]}),s.claimVerified&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-[2rem] border border-slate-100 dark:border-slate-700 flex flex-col items-center justify-center shadow-sm",children:[e.jsx("div",{className:"p-3 bg-white rounded-2xl shadow-md mb-3",children:e.jsx(se,{value:s.idUnik||"000",size:90})}),e.jsxs("p",{className:"text-[9px] font-black text-indigo-600 uppercase tracking-widest",children:["ID Akses: ",s.idUnik]})]})]}),e.jsx("button",{onClick:D,className:"w-full py-4 rounded-2xl bg-rose-50 text-rose-600 text-[10px] font-black uppercase tracking-[0.3em] border border-rose-100 active:scale-95 transition-all",children:"Keluar Aplikasi"})]}),V&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md",children:e.jsxs("div",{className:"bg-white dark:bg-[#0B1121] w-full max-w-md rounded-[3rem] p-8 shadow-2xl animate-in zoom-in duration-300 border border-white/10 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h3",{className:"text-xl font-black text-slate-800 dark:text-white uppercase",children:"Klaim Identitas"}),e.jsx("button",{onClick:()=>g(!1),className:"p-2 text-slate-400",children:e.jsx(Y,{className:"w-8 h-8"})})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>w("siswa"),className:`py-4 rounded-2xl border font-black text-[10px] uppercase transition-all ${l==="siswa"?"bg-indigo-600 border-indigo-600 text-white shadow-lg":"bg-slate-50 text-slate-400"}`,children:"Siswa"}),e.jsx("button",{type:"button",onClick:()=>w("guru"),className:`py-4 rounded-2xl border font-black text-[10px] uppercase transition-all ${l==="guru"?"bg-indigo-600 border-indigo-600 text-white shadow-lg":"bg-slate-50 text-slate-400"}`,children:"Guru/Staf"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5 relative",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:l==="siswa"?"Nomor NISN":"NIP / NIK Resmi"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{required:!0,type:"text",value:m,onChange:a=>$(a.target.value),className:v(n.found),placeholder:l==="siswa"?"10 Digit NISN":"Nomor NIP"}),e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2",children:[n.checking&&e.jsx(b,{className:"w-4 h-4 animate-spin text-indigo-500"}),n.found&&e.jsx(U,{className:"w-5 h-5 text-emerald-500"})]})]}),n.found&&e.jsxs("p",{className:"text-[9px] font-black text-emerald-600 uppercase mt-2 ml-1 flex items-center gap-1.5",children:[e.jsx(U,{className:"w-3 h-3"})," Ditemukan: ",((I=n.data)==null?void 0:I.namaLengkap)||((S=n.data)==null?void 0:S.name)]})]}),e.jsxs("div",{className:"space-y-1.5 relative",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:l==="siswa"?"Siswa ID (Kunci)":"Nama Lengkap (Konfirmasi)"}),e.jsx("input",{required:!0,type:"text",value:x,onChange:a=>z(a.target.value),className:v(x.length>3),placeholder:l==="siswa"?"Cek di Rapor":"Nama Lengkap Anda"})]})]}),e.jsx("button",{type:"submit",disabled:N||!n.found,className:`w-full py-4.5 rounded-2xl font-black text-[11px] uppercase tracking-[0.2em] shadow-xl flex items-center justify-center gap-3 active:scale-[0.98] transition-all ${n.found?"bg-indigo-600 text-white":"bg-slate-100 text-slate-400 cursor-not-allowed"}`,children:N?e.jsx(b,{className:"w-5 h-5 animate-spin"}):"Ajukan Klaim Sekarang"})]})]})})]})})};export{ne as default};
