import{i as p,d as c,r as o,j as e,p as M,w as T,a5 as A,a as _,a3 as B,T as P,x as z,X as L,a6 as O,z as F,t as u,U as v}from"./index-CcQVG4nr.js";import{L as H}from"./Layout-aA6jRwwe.js";const b="teachers",i="imam_teachers_cache_v1",S="imam_teachers_cache_time",q=1e3*60*60,G=async(l=!1)=>{if(p)return[{id:"t1",name:"Budi Santoso, S.Pd",nip:"198001012005011001",subject:"Matematika",status:"PNS"},{id:"t2",name:"Siti Aminah, M.Ag",nip:"198505052010012003",subject:"Fikih",status:"PNS"}];if(!l){const a=localStorage.getItem(i),s=localStorage.getItem(S);if(a&&s&&Date.now()-parseInt(s)<q)return console.log("IMAM DB: Memuat data guru dari Cache"),JSON.parse(a)}try{if(!c)throw new Error("Database not initialized");console.log("IMAM DB: Fetching teachers from server...");const s=(await c.collection(b).orderBy("name").get()).docs.map(m=>({id:m.id,...m.data()}));return localStorage.setItem(i,JSON.stringify(s)),localStorage.setItem(S,Date.now().toString()),s}catch(a){console.error("Error fetching teachers:",a);const s=localStorage.getItem(i);return s?JSON.parse(s):[]}},J=async l=>{if(!p)try{if(!c)throw new Error("Database not initialized");await c.collection(b).add(l),localStorage.removeItem(i)}catch(a){throw a}},K=async(l,a)=>{if(!p)try{if(!c)throw new Error("Database not initialized");await c.collection(b).doc(l).update(a),localStorage.removeItem(i)}catch(s){throw s}},R=async l=>{if(!p)try{if(!c)throw new Error("Database not initialized");await c.collection(b).doc(l).delete(),localStorage.removeItem(i)}catch(a){throw a}},Y=({onBack:l,userRole:a})=>{const[s,m]=o.useState([]),[w,y]=o.useState(!0),[g,I]=o.useState(""),[C,d]=o.useState(!1),[f,k]=o.useState(null),[n,x]=o.useState({name:"",nip:"",subject:"",status:"PNS"}),h=async(t=!1)=>{y(!0);try{const r=await G(t);m(r)}catch{u.error("Gagal sinkronisasi data")}finally{y(!1)}};o.useEffect(()=>{h()},[]);const j=a===v.ADMIN||a===v.DEVELOPER,N=o.useMemo(()=>{const t=g.toLowerCase().trim();return s.filter(r=>String(r.name).toLowerCase().includes(t)||String(r.nip).includes(t))},[s,g]),E=t=>{k(t.id||null),x({...t}),d(!0)},D=async t=>{t.preventDefault();const r=u.loading("Menyimpan...");try{f?await K(f,n):await J(n),d(!1),u.success("Berhasil disimpan",{id:r}),h(!0)}catch{u.error("Gagal menyimpan",{id:r})}};return e.jsxs(H,{title:"Data guru",subtitle:"Direktori GTK madrasah",icon:M,onBack:l,actions:e.jsx("button",{onClick:()=>h(!0),className:"p-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-500 hover:text-indigo-600 transition-all",children:e.jsx(F,{className:`w-5 h-5 ${w?"animate-spin":""}`})}),children:[e.jsxs("div",{className:"p-4 lg:p-6 pb-32 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#151E32] p-4 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-sm flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(T,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Cari di memori lokal...",value:g,onChange:t=>I(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-900 border-none rounded-2xl py-3 pl-12 text-[10.5px] font-medium outline-none focus:ring-2 focus:ring-indigo-500/20 shadow-inner"})]}),j&&e.jsxs("button",{onClick:()=>{k(null),x({name:"",nip:"",subject:"",status:"PNS"}),d(!0)},className:"w-full md:w-auto bg-indigo-600 text-white px-6 py-3 rounded-2xl text-[10.5px] font-bold flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-all",children:[e.jsx(A,{className:"w-4 h-4"})," Tambah guru"]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#151E32] rounded-[2rem] border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden flex flex-col",children:[e.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:e.jsxs("table",{className:"excel-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center w-12",children:"No"}),e.jsx("th",{children:"Nama lengkap"}),e.jsx("th",{className:"text-center",children:"Nip / niy"}),e.jsx("th",{children:"Mata pelajaran"}),e.jsx("th",{className:"text-center",children:"Status"}),j&&e.jsx("th",{className:"text-center w-24",children:"Aksi"})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-20 text-center",children:e.jsx(_,{className:"w-8 h-8 animate-spin mx-auto text-indigo-500 opacity-20"})})}):N.length>0?N.map((t,r)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center font-mono text-slate-400",children:r+1}),e.jsx("td",{className:"font-bold text-slate-800 dark:text-slate-200 capitalize",children:t.name}),e.jsx("td",{className:"text-center font-mono text-slate-500",children:t.nip||"-"}),e.jsx("td",{className:"font-bold text-indigo-600 dark:text-indigo-400 capitalize",children:t.subject||"-"}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-[9px] font-bold ${t.status==="PNS"?"bg-emerald-50 text-emerald-600":"bg-amber-50 text-amber-600"}`,children:t.status})}),j&&e.jsx("td",{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>E(t),className:"p-1 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-indigo-600 transition-colors",children:e.jsx(B,{className:"w-3 h-3"})}),e.jsx("button",{onClick:async()=>{confirm("Hapus data guru?")&&(await R(t.id),h(!0))},className:"p-1 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-rose-600 transition-colors",children:e.jsx(P,{className:"w-3 h-3"})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-20 text-center text-slate-400 font-medium",children:"Data tidak ditemukan"})})})]})}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-3 flex justify-between items-center border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("p",{className:"text-[10px] font-bold text-slate-400",children:["Total: ",N.length," personil"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[9px] font-black text-indigo-400 uppercase tracking-widest",children:[e.jsx(z,{className:"w-3 h-3"})," Cached Access Active"]})]})]})]}),C&&e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md",children:e.jsxs("div",{className:"bg-white dark:bg-[#0B1121] w-full max-w-lg rounded-[2.5rem] shadow-2xl overflow-hidden animate-in zoom-in duration-200 flex flex-col border border-white/10",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-white dark:bg-[#0B1121]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-white leading-none",children:f?"Edit data guru":"Tambah guru baru"}),e.jsx("p",{className:"text-[10px] font-medium text-indigo-400 mt-2 uppercase tracking-widest",children:"Database kepegawaian"})]}),e.jsx("button",{onClick:()=>d(!1),className:"p-2 rounded-full hover:bg-slate-100 text-slate-400",children:e.jsx(L,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("form",{id:"teacherForm",onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 ml-1 uppercase",children:"Nama lengkap & gelar *"}),e.jsx("input",{required:!0,type:"text",value:n.name||"",onChange:t=>x({...n,name:t.target.value}),className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 rounded-2xl py-3 px-4 text-[10.5px] font-bold outline-none shadow-inner"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 ml-1 uppercase",children:"Nip / niy"}),e.jsx("input",{type:"text",value:n.nip||"",onChange:t=>x({...n,nip:t.target.value}),className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 rounded-2xl py-3 px-4 text-[10.5px] font-bold outline-none shadow-inner"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 ml-1 uppercase",children:"Mata pelajaran *"}),e.jsx("input",{required:!0,type:"text",value:n.subject||"",onChange:t=>x({...n,subject:t.target.value}),className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 rounded-2xl py-3 px-4 text-[10.5px] font-bold outline-none shadow-inner"})]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-slate-100 dark:border-slate-800 flex gap-3 bg-slate-50 dark:bg-[#0B1121]",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-4 rounded-2xl bg-white dark:bg-slate-800 text-slate-500 font-bold text-[10.5px] uppercase",children:"Batal"}),e.jsxs("button",{type:"submit",form:"teacherForm",className:"flex-[2] bg-indigo-600 text-white font-bold py-4 rounded-2xl text-[10.5px] shadow-xl flex items-center justify-center gap-2 uppercase tracking-widest",children:[e.jsx(O,{className:"w-4 h-4"})," Simpan data"]})]})]})})]})};export{Y as default};
