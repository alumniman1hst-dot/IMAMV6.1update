import{r as s,i as f,d as n,j as e,m as v,f as A,w as I,a as C,z as L,c as j,U as M}from"./index-CcQVG4nr.js";import{L as E}from"./Layout-aA6jRwwe.js";import{f as P}from"./format-DylC2ZLE.js";const D=({onBack:g,userRole:N})=>{const[l,w]=s.useState(P(new Date,"yyyy-MM-dd")),[r,y]=s.useState("All"),[d,k]=s.useState(""),[o,i]=s.useState([]),[S,x]=s.useState([]),[u,c]=s.useState(!0),h=N===M.SISWA;s.useEffect(()=>{f?x(["X IPA 1","XI IPS 1","XII AGAMA"]):n&&n.collection("classes").get().then(t=>x(t.docs.map(a=>a.data().name).sort()))},[]);const m=async()=>{if(c(!0),f){setTimeout(()=>{i([{id:"r1",studentName:"Adelia Sri Sundari",class:"X IPA 1",date:l,status:"Hadir",checkIn:"07:15",checkOut:"16:00"}]),c(!1)},500);return}if(!(!n||!j.currentUser))try{let t=n.collection("attendance").where("date","==",l).limit(50);h?t=t.where("studentId","==",j.currentUser.uid):r!=="All"&&(t=t.where("class","==",r));const a=await t.get();i(a.docs.map(b=>({id:b.id,...b.data()})))}catch(t){console.error(t)}finally{c(!1)}};s.useEffect(()=>{m()},[l,r]);const p=s.useMemo(()=>{const t=d.toLowerCase().trim();return o.filter(a=>String(a.studentName).toLowerCase().includes(t))},[o,d]);return e.jsx(E,{title:"Riwayat Absensi",subtitle:"Log Kehadiran",icon:v,onBack:g,actions:e.jsx("button",{onClick:m,className:"p-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-500",children:e.jsx(L,{className:`w-5 h-5 ${u?"animate-spin":""}`})}),children:e.jsxs("div",{className:"p-4 lg:p-8 pb-32 space-y-5 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-[#151E32] p-4 rounded-3xl border border-slate-100 dark:border-slate-800 shadow-sm flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"date",value:l,onChange:t=>w(t.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl text-[10.5px] font-bold outline-none"})]}),!h&&e.jsx("div",{className:"relative",children:e.jsxs("select",{value:r,onChange:t=>y(t.target.value),className:"w-full pl-4 pr-8 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl text-[10.5px] font-bold outline-none appearance-none cursor-pointer",children:[e.jsx("option",{value:"All",children:"Semua kelas"}),S.map(t=>e.jsx("option",{value:t,children:t},t))]})})]}),e.jsxs("div",{className:"relative flex-[1.5]",children:[e.jsx(I,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Filter hasil...",value:d,onChange:t=>k(t.target.value),className:"w-full pl-11 py-3 bg-slate-50 dark:bg-slate-900 border-none rounded-2xl text-[10.5px] font-medium outline-none shadow-inner"})]})]}),e.jsx("div",{className:"bg-white dark:bg-[#151E32] rounded-[2rem] border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:e.jsxs("table",{className:"excel-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center w-10",children:"No"}),e.jsx("th",{children:"Nama Siswa"}),e.jsx("th",{className:"text-center",children:"Masuk"}),e.jsx("th",{className:"text-center",children:"Pulang"}),e.jsx("th",{className:"text-center",children:"Status"})]})}),e.jsx("tbody",{children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-20 text-center",children:e.jsx(C,{className:"w-8 h-8 animate-spin mx-auto text-indigo-500 opacity-20"})})}):p.length>0?p.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center font-mono text-slate-400",children:a+1}),e.jsx("td",{className:"font-bold text-slate-800 dark:text-slate-200 uppercase",children:t.studentName}),e.jsx("td",{className:"text-center font-mono",children:t.checkIn?t.checkIn.substring(0,5):"-"}),e.jsx("td",{className:"text-center font-mono",children:t.checkOut?t.checkOut.substring(0,5):"-"}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-[9px] font-bold ${t.status==="Alpha"?"bg-red-50 text-red-600":"bg-emerald-50 text-emerald-600"}`,children:t.status})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-20 text-center text-slate-400 font-medium",children:"Log tidak ditemukan (Limit 50)"})})})]})})})]})})};export{D as default};
