import{r as s,j as e,A as Z,X as _,a as M,C as D,e as ee,b as te,i as E,d as j,t as T,U as V,c as ae}from"./index-CcQVG4nr.js";const le=({onLogin:v,onLoginClick:$})=>{var A,L;const[a,S]=s.useState("student"),[q,f]=s.useState(1),[p,G]=s.useState(""),[h,K]=s.useState(""),[g,W]=s.useState(""),[y,X]=s.useState(""),[b,z]=s.useState(""),[u,B]=s.useState(""),[I,O]=s.useState(""),[l,c]=s.useState({found:!1,data:null,checking:!1}),[n,F]=s.useState(null),[C,N]=s.useState(!1),[U,m]=s.useState(null),H=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),P=u.length>=6,R=I===u&&u!=="";s.useEffect(()=>{const t=a==="student"?p.trim():g.trim(),o=a==="student"?10:8;if(t.length<o){c({found:!1,data:null,checking:!1});return}const r=setTimeout(async()=>{var i;c(k=>({...k,checking:!0}));try{if(E){await new Promise(Y=>setTimeout(Y,600)),c({found:!0,data:a==="student"?{namaLengkap:"SISWA SIMULASI MASTER",idUnik:"1234",isClaimed:!1}:{name:"GURU SIMULASI MASTER",isClaimed:!1},checking:!1});return}const k=a==="student"?"students":"teachers",w=await j.collection(k).doc(t).get();w.exists&&!((i=w.data())!=null&&i.isClaimed)?c({found:!0,data:w.data(),checking:!1}):c({found:!1,data:null,checking:!1})}catch{c({found:!1,data:null,checking:!1})}},500);return()=>clearTimeout(r)},[p,g,a]);const x=t=>`w-full border rounded-2xl py-4 px-5 text-sm font-bold shadow-inner outline-none transition-all duration-300 ${t?"bg-emerald-50 border-emerald-500 text-emerald-900 focus:ring-4 focus:ring-emerald-500/10":"bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-700 focus:ring-4 focus:ring-indigo-500/5"}`,J=async t=>{var o,d,r;if(t.preventDefault(),!l.found){m(`Data ${a==="student"?"NISN":"NIP"} tidak valid.`);return}if(a==="student"&&String((o=l.data)==null?void 0:o.idUnik)!==h){m("Siswa ID tidak cocok.");return}F({id:a==="student"?p:g,...l.data}),X(((d=l.data)==null?void 0:d.namaLengkap)||((r=l.data)==null?void 0:r.name)),f(2),T.success("Identitas Terverifikasi!")},Q=async t=>{if(t.preventDefault(),N(!0),m(null),!R){m("Sandi tidak cocok."),N(!1);return}const o=a==="student"?V.SISWA:V.GURU;try{if(E){await new Promise(r=>setTimeout(r,1e3)),v(o);return}const d=await ae.createUserWithEmailAndPassword(b.trim(),u);if(d.user){const r=d.user.uid;await d.user.updateProfile({displayName:y});const i={uid:r,displayName:y,email:b.trim(),role:o,createdAt:new Date().toISOString(),claimVerified:!0};a==="student"?(i.studentId=n.id,i.idUnik=n.idUnik,i.nisn=n.nisn,i.class=n.tingkatRombel):(i.teacherId=n.id,i.nip=n.nip),await j.collection("users").doc(r).set(i),await j.collection(a==="student"?"students":"teachers").doc(n.id).update({isClaimed:!0,linkedUserId:r}),v(o),T.success("Pendaftaran berhasil!")}}catch(d){m(d.message)}finally{N(!1)}};return e.jsx("div",{className:"flex flex-col h-full w-full bg-[#f8fafc] dark:bg-[#020617] relative overflow-hidden font-sans",children:e.jsx("div",{className:"flex-1 flex flex-col justify-center px-6 z-10 relative",children:e.jsxs("div",{className:"w-full max-w-md mx-auto bg-white/95 dark:bg-[#0B1121]/95 backdrop-blur-xl border border-slate-200 dark:border-slate-800 rounded-[3rem] p-8 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx(Z,{className:"w-16 h-16 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tight",children:"Pendaftaran"}),e.jsxs("div",{className:"flex justify-center gap-2 mt-6 bg-slate-100 dark:bg-slate-900 p-1.5 rounded-2xl",children:[e.jsx("button",{onClick:()=>{S("student"),f(1),c({found:!1,data:null,checking:!1})},className:`flex-1 text-[10px] font-black px-6 py-3 rounded-xl transition-all uppercase tracking-widest ${a==="student"?"bg-white dark:bg-slate-700 text-indigo-600 shadow-md":"text-slate-400"}`,children:"Siswa"}),e.jsx("button",{onClick:()=>{S("staff"),f(1),c({found:!1,data:null,checking:!1})},className:`flex-1 text-[10px] font-black px-6 py-3 rounded-xl transition-all uppercase tracking-widest ${a==="staff"?"bg-white dark:bg-slate-700 text-indigo-600 shadow-md":"text-slate-400"}`,children:"Guru/GTK"})]})]}),U&&e.jsxs("div",{className:"mb-6 p-4 rounded-2xl bg-rose-50 dark:bg-rose-900/20 border border-rose-100 flex items-start gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-rose-600 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-[10px] text-rose-600 dark:text-rose-400 font-bold leading-relaxed",children:U})]}),q===1?e.jsxs("form",{onSubmit:J,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1.5 relative",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:a==="student"?"Nomor NISN":"NIP / NIK"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{required:!0,type:"text",value:a==="student"?p:g,onChange:t=>a==="student"?G(t.target.value):W(t.target.value),className:x(l.found),placeholder:a==="student"?"10 Digit NISN":"Nomor NIP"}),e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[l.checking&&e.jsx(M,{className:"w-5 h-5 animate-spin text-indigo-500"}),l.found&&e.jsx(D,{className:"w-5 h-5 text-emerald-500 animate-checkmark"})]})]}),l.found&&e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-950/30 p-3 rounded-xl mt-2 border border-emerald-100 flex items-center gap-3",children:[e.jsx(ee,{className:"w-4 h-4 text-emerald-600"}),e.jsxs("span",{className:"text-[10px] font-black text-emerald-700 uppercase truncate",children:["âœ“ ",((A=l.data)==null?void 0:A.namaLengkap)||((L=l.data)==null?void 0:L.name)]})]})]}),a==="student"&&e.jsxs("div",{className:"space-y-1.5 relative",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Siswa ID (Kunci)"}),e.jsx("input",{required:!0,type:"text",value:h,onChange:t=>K(t.target.value),className:x(h.length>3),placeholder:"ID Lokal di Rapor"})]}),e.jsxs("button",{type:"submit",disabled:!l.found||a==="student"&&h.length<3,className:`w-full py-4.5 rounded-[1.8rem] font-black text-xs uppercase tracking-[0.2em] shadow-xl flex items-center justify-center gap-3 active:scale-95 transition-all ${l.found?"bg-indigo-600 text-white shadow-indigo-500/20":"bg-slate-100 text-slate-400 cursor-not-allowed"}`,children:["Lanjutkan Registrasi ",e.jsx(te,{className:"w-4 h-4"})]})]}):e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-3xl border border-emerald-100 flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-emerald-500 text-white flex items-center justify-center shadow-lg",children:e.jsx(D,{className:"w-6 h-6"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[9px] font-black text-emerald-700 dark:text-emerald-400 uppercase leading-none mb-1",children:"Terverifikasi"}),e.jsx("p",{className:"text-[11px] text-emerald-600 dark:text-emerald-400 font-bold truncate",children:(n==null?void 0:n.namaLengkap)||(n==null?void 0:n.name)})]})]}),e.jsxs("div",{className:"space-y-1.5 relative",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase ml-1",children:"Email Aktif"}),e.jsx("input",{required:!0,type:"email",value:b,onChange:t=>z(t.target.value),className:x(H(b)),placeholder:"email@contoh.com"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{required:!0,type:"password",value:u,onChange:t=>B(t.target.value),className:x(P),placeholder:"Sandi"}),e.jsx("input",{required:!0,type:"password",value:I,onChange:t=>O(t.target.value),className:x(R&&P),placeholder:"Ulang"})]}),e.jsx("button",{type:"submit",disabled:C,className:"w-full py-4.5 bg-indigo-600 text-white rounded-[1.8rem] font-black text-xs uppercase tracking-[0.2em] shadow-xl flex items-center justify-center gap-2 active:scale-95 transition-all",children:C?e.jsx(M,{className:"w-5 h-5 animate-spin"}):"Selesaikan Pendaftaran"}),e.jsx("button",{type:"button",onClick:()=>f(1),className:"w-full py-2 text-[9px] font-black text-slate-400 uppercase tracking-[0.2em] hover:text-indigo-600 transition-colors mt-2",children:"Ganti Identitas"})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-100 dark:border-slate-800 text-center",children:e.jsxs("p",{className:"text-slate-500 text-[11px] font-bold",children:["Sudah memiliki akun? ",e.jsx("button",{onClick:$,className:"text-indigo-600 font-black hover:underline ml-1",children:"Masuk Sekarang"})]})})]})})})};export{le as default};
