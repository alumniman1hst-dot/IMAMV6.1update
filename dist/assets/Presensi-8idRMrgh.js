import{r as a,j as e,q as M,P as C,s as A,V as D,u as I,v as H,w as L,H as T,a as E,i as P,d as f}from"./index-CcQVG4nr.js";import{g as R}from"./studentService-CIZKz8Ta.js";import{f as x}from"./format-DylC2ZLE.js";const q=({onBack:g,onNavigate:j})=>{const[l,h]=a.useState(new Date),[d,N]=a.useState(""),[m,w]=a.useState([]),[u,k]=a.useState([]),[y,r]=a.useState(!0),[p,v]=a.useState(!1);a.useEffect(()=>{(async()=>{r(!0);try{const n=x(l,"yyyy-MM-dd"),i=await R();if(w(i.filter(s=>s.status==="Aktif")),!P&&f){const s=f.collection("attendance").where("date","==",n).onSnapshot(S=>{k(S.docs.map(b=>({id:b.id,...b.data()}))),r(!1)},()=>r(!1));return()=>s()}else r(!1)}catch(n){console.error(n),r(!1)}})()},[l]);const c=a.useMemo(()=>{const t=d.toLowerCase(),n=m.filter(s=>String(s.namaLengkap).toLowerCase().includes(t)),i=new Map(u.map(s=>[s.studentId,s]));return n.map(s=>i.get(s.id)||{id:`${s.id}_${x(l,"yyyy-MM-dd")}`,studentId:s.id,studentName:s.namaLengkap,class:s.tingkatRombel,status:"Alpha",checkIn:null,checkOut:null,duha:null,zuhur:null,ashar:null})},[m,u,d,l]),o=t=>t?t.endsWith(" H")?t:t.startsWith("Haid")?"Haid":t.substring(0,5):"-";return e.jsxs("div",{className:"flex flex-col h-full bg-[#f8fafc] dark:bg-[#020617] overflow-hidden",children:[e.jsxs("div",{className:"bg-white/80 dark:bg-[#0B1121]/90 backdrop-blur-xl px-5 py-4 flex items-center justify-between border-b border-slate-100 dark:border-slate-800 safe-pt z-40",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:g,className:"p-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-slate-900 dark:text-white text-[10.5px] leading-none uppercase tracking-widest",children:"Presensi harian"}),e.jsx("p",{className:"text-[10px] font-medium text-indigo-600 mt-1.5",children:"Spreadsheet View"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"p-2.5 bg-slate-100 dark:bg-slate-800 text-slate-500 rounded-xl",children:e.jsx(C,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>j(D.SCANNER),className:"p-2.5 bg-indigo-600 text-white rounded-xl shadow-lg",children:e.jsx(A,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"p-4 lg:p-6 space-y-6 pb-32",children:[e.jsxs("div",{className:"bg-white dark:bg-[#151E32] p-4 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 dark:bg-slate-900 p-1 rounded-xl shadow-inner",children:[e.jsx("button",{onClick:()=>h(new Date(l.getTime()-864e5)),className:"p-2 hover:bg-white rounded-lg transition-all",children:e.jsx(I,{className:"w-4 h-4 text-slate-400"})}),e.jsx("div",{className:"px-2 text-center min-w-[100px]",children:e.jsx("h3",{className:"text-[10.5px] font-bold text-slate-800 dark:text-white",children:x(l,"dd MMM yyyy")})}),e.jsx("button",{onClick:()=>h(new Date(l.getTime()+864e5)),className:"p-2 hover:bg-white rounded-lg transition-all",children:e.jsx(H,{className:"w-4 h-4 text-slate-400"})})]}),e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(L,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Filter nama siswa...",value:d,onChange:t=>N(t.target.value),className:"w-full pl-11 py-3 bg-slate-50 dark:bg-slate-900 border-none rounded-xl text-[10.5px] font-medium focus:ring-2 focus:ring-indigo-500/20 shadow-inner"})]}),e.jsxs("button",{onClick:()=>v(!p),className:`px-5 py-3 rounded-xl text-[10.5px] font-bold border transition-all ${p?"bg-rose-600 text-white border-rose-400 animate-pulse shadow-lg":"bg-white dark:bg-slate-800 text-slate-400"}`,children:[e.jsx(T,{className:"w-4 h-4 inline-block mr-2"})," Quick haid"]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#151E32] rounded-3xl border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden flex flex-col",children:[e.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:e.jsxs("table",{className:"excel-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center w-10",children:"No"}),e.jsx("th",{children:"Nama lengkap"}),e.jsx("th",{className:"text-center",children:"Kelas"}),e.jsx("th",{className:"text-center",children:"Masuk"}),e.jsx("th",{className:"text-center",children:"Duha"}),e.jsx("th",{className:"text-center",children:"Pulang"}),e.jsx("th",{className:"text-center w-20",children:"Status"})]})}),e.jsx("tbody",{children:y?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-20 text-center",children:e.jsx(E,{className:"w-8 h-8 animate-spin mx-auto text-indigo-500 opacity-20"})})}):c.length>0?c.map((t,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center font-mono text-slate-400",children:n+1}),e.jsx("td",{className:"font-bold capitalize",children:t.studentName}),e.jsx("td",{className:"text-center font-medium text-slate-500",children:t.class}),e.jsx("td",{className:"text-center font-mono",children:o(t.checkIn)}),e.jsx("td",{className:"text-center font-mono",children:o(t.duha)}),e.jsx("td",{className:"text-center font-mono",children:o(t.checkOut)}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-[9px] font-bold ${t.status==="Alpha"?"bg-red-50 text-red-600":t.status==="Haid"?"bg-rose-50 text-rose-600":"bg-emerald-50 text-emerald-600"}`,children:t.status})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-20 text-center text-slate-400 font-medium",children:"Tidak ada data siswa untuk ditampilkan"})})})]})}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-3 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:[e.jsxs("span",{children:["Total: ",c.length," records"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," Cache Sync Active"]})]})]})]})})]})};export{q as default};
