import{r,U as l,j as e,S as w,a5 as F,a as Q,X as T,y as B,I as U,C as J,w as Y,N as V,a6 as Z,i as K,c as v,d as o,t as y}from"./index-CcQVG4nr.js";import{L as ee}from"./Layout-aA6jRwwe.js";const se=({onBack:S})=>{const[n,j]=r.useState(l.SISWA),[u,b]=r.useState("status"),[z,A]=r.useState(!0),[P,W]=r.useState(""),[c,_]=r.useState(100),[x,N]=r.useState([]),[D,M]=r.useState([]),[$,E]=r.useState([]),[G,R]=r.useState(!1),[a,h]=r.useState({studentId:"",ruleId:"",type:"Violation",note:""}),O=n===l.STAF_TU||n===l.ADMIN||n===l.DEVELOPER,H=n===l.GURU||n===l.WALI_KELAS,C=n===l.SISWA;r.useEffect(()=>{(async()=>{var g,k;if(A(!0),K){setTimeout(()=>{j(l.ADMIN),M([{id:"R1",category:"Kedisiplinan",description:"Terlambat datang ke sekolah (> 15 menit)",points:5},{id:"R2",category:"Kerapihan",description:"Berambut panjang/tidak rapi (Laki-laki)",points:10},{id:"R3",category:"Pelanggaran Berat",description:"Membawa rokok atau merokok di sekolah",points:100},{id:"R4",category:"Kedisiplinan",description:"Atribut seragam tidak lengkap",points:5}]),N([{id:"1",studentId:"s1",studentName:"Ahmad Dahlan",type:"Violation",ruleId:"R1",ruleDescription:"Terlambat Masuk",points:-5,date:"2024-05-20",recordedBy:"Admin",status:"Approved"}]),E([{id:"s1",namaLengkap:"Ahmad Dahlan",tingkatRombel:"X IPA 1",nisn:"123"}]),A(!1)},500);return}if(v.currentUser&&o){const i=await o.collection("users").doc(v.currentUser.uid).get(),d=(g=i.data())==null?void 0:g.role;j(d);const p=await o.collection("violations_master").get();if(M(p.docs.map(s=>({id:s.id,...s.data()}))),d===l.SISWA){const s=await o.collection("discipline_logs").where("studentId","==",v.currentUser.uid).orderBy("date","desc").get();N(s.docs.map(m=>({id:m.id,...m.data()}))),_(((k=i.data())==null?void 0:k.disciplinePoints)||100)}else{const s=await o.collection("discipline_logs").orderBy("date","desc").limit(50).get();N(s.docs.map(f=>({id:f.id,...f.data()})));const m=await o.collection("students").where("status","==","Aktif").get();E(m.docs.map(f=>({id:f.id,...f.data()})))}}A(!1)})()},[]);const X=async t=>{var k;if(t.preventDefault(),!a.studentId||!a.ruleId){y.error("Mohon pilih siswa dan jenis pelanggaran.");return}const g=y.loading("Mencatat poin...");try{const i=$.find(s=>s.id===a.studentId),d=D.find(s=>s.id===a.ruleId);if(!i||!d)throw new Error("Data invalid");const p={studentId:i.id,studentName:i.namaLengkap,type:a.type,ruleId:d.id,ruleDescription:d.description,points:a.type==="Violation"?-d.points:d.points,date:new Date().toISOString(),recordedBy:((k=v.currentUser)==null?void 0:k.displayName)||"Guru",status:d.points>=50?"Pending":"Approved",note:a.note};if(K)await new Promise(s=>setTimeout(s,800)),N(s=>[{id:Date.now().toString(),...p},...s]);else if(o){const s=await o.collection("discipline_logs").add(p);if(p.status==="Approved"){const m=i.disciplinePoints||100;await o.collection("users").doc(i.linkedUserId||i.id).update({disciplinePoints:m+p.points})}}y.success("Pelanggaran berhasil dicatat!",{id:g}),R(!1),h({studentId:"",ruleId:"",type:"Violation",note:""})}catch{y.error("Gagal mencatat data.",{id:g})}},L=t=>t>=90?{label:"Sangat Baik",color:"text-emerald-500",bg:"bg-emerald-50 dark:bg-emerald-900/20"}:t>=75?{label:"Baik",color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"}:t>=60?{label:"Cukup",color:"text-amber-500",bg:"bg-amber-50 dark:bg-amber-900/20"}:{label:"Perlu Pembinaan",color:"text-rose-500",bg:"bg-rose-50 dark:bg-rose-900/20"},q=D.filter(t=>t.description.toLowerCase().includes(P.toLowerCase())||t.category.toLowerCase().includes(P.toLowerCase()));return e.jsxs(ee,{title:"Disiplin & Poin",subtitle:"Karakter & Ketertiban",icon:w,onBack:S,children:[e.jsxs("div",{className:"p-4 lg:p-8 pb-32 space-y-6 max-w-5xl mx-auto w-full",children:[e.jsxs("div",{className:"flex p-1.5 bg-slate-100 dark:bg-slate-800 rounded-2xl w-fit mx-auto border border-slate-200 dark:border-slate-700 shadow-inner",children:[e.jsx("button",{onClick:()=>b("status"),className:`px-8 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${u==="status"?"bg-white dark:bg-slate-700 text-indigo-600 dark:text-white shadow-sm ring-1 ring-black/5":"text-slate-400"}`,children:n===l.SISWA?"Status Saya":"Daftar Log"}),e.jsx("button",{onClick:()=>b("rules"),className:`px-8 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${u==="rules"?"bg-white dark:bg-slate-700 text-indigo-600 dark:text-white shadow-sm ring-1 ring-black/5":"text-slate-400"}`,children:"Daftar Aturan"}),(O||H)&&e.jsxs("button",{onClick:()=>R(!0),className:"ml-2 px-6 py-2.5 bg-indigo-600 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-lg flex items-center gap-2 active:scale-95 transition-all",children:[e.jsx(F,{className:"w-4 h-4"})," Input"]})]}),z?e.jsxs("div",{className:"py-20 text-center flex flex-col items-center gap-3",children:[e.jsx(Q,{className:"w-10 h-10 animate-spin text-indigo-500 opacity-20"}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Sinkronisasi Data Disiplin..."})]}):u==="status"?e.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[!C&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(I,{label:"Total Kasus",value:x.length,icon:w,color:"text-indigo-600",bg:"bg-indigo-50"}),e.jsx(I,{label:"Pelanggaran",value:x.filter(t=>t.type==="Violation").length,icon:T,color:"text-rose-600",bg:"bg-rose-50"}),e.jsx(I,{label:"Prestasi/Reward",value:x.filter(t=>t.type==="Reward").length,icon:B,color:"text-emerald-600",bg:"bg-emerald-50"}),e.jsx(I,{label:"Sanksi Berat",value:x.filter(t=>Math.abs(t.points)>=50).length,icon:U,color:"text-amber-600",bg:"bg-amber-50"})]}),C&&e.jsxs("div",{className:"bg-indigo-600 rounded-[2.5rem] p-8 text-white shadow-xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-10 opacity-10 rotate-12",children:e.jsx(B,{className:"w-40 h-40"})}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row md:items-end justify-between gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.25em] opacity-70 mb-2",children:"Skor Kredit Disiplin"}),e.jsxs("h2",{className:"text-5xl font-black",children:[c," ",e.jsx("span",{className:"text-xl opacity-50 font-medium",children:"/ 100"})]}),e.jsxs("div",{className:`mt-4 inline-flex items-center gap-2 px-4 py-1.5 rounded-xl border border-white/10 ${L(c).bg} ${L(c).color} font-black text-[10px] uppercase tracking-widest`,children:[e.jsx(J,{className:"w-4 h-4"})," ",L(c).label]})]}),e.jsxs("div",{className:"w-full md:w-48 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] font-black uppercase tracking-widest opacity-70",children:[e.jsx("span",{children:"Health Bar"}),e.jsxs("span",{children:[c,"%"]})]}),e.jsx("div",{className:"h-2 bg-white/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-1000",style:{width:`${c}%`}})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] ml-2",children:"Riwayat Pencatatan Terkini"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[x.map(t=>e.jsxs("div",{className:"bg-white dark:bg-[#151E32] p-5 rounded-[2rem] border border-slate-100 dark:border-slate-800 shadow-sm flex items-center justify-between group transition-all hover:border-indigo-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center border-2 ${t.type==="Reward"?"bg-emerald-50 text-emerald-600 border-emerald-100":"bg-rose-50 text-rose-600 border-rose-100"}`,children:t.type==="Reward"?e.jsx(B,{className:"w-6 h-6"}):e.jsx(T,{className:"w-6 h-6"})}),e.jsxs("div",{className:"min-w-0 pr-4",children:[e.jsx("h4",{className:"text-[11px] font-black text-slate-800 dark:text-white uppercase tracking-tight truncate max-w-[200px] sm:max-w-md",children:t.ruleDescription}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1.5",children:[!C&&e.jsx("span",{className:"text-[9px] font-black text-indigo-600 uppercase tracking-widest",children:t.studentName}),e.jsx("span",{className:"text-slate-200 dark:text-slate-800",children:"•"}),e.jsx("span",{className:"text-[8px] font-bold text-slate-400 uppercase",children:new Date(t.date).toLocaleDateString("id-ID",{day:"numeric",month:"short"})}),e.jsx("span",{className:"text-slate-200 dark:text-slate-800",children:"•"}),e.jsx("span",{className:`text-[8px] font-black uppercase px-2 py-0.5 rounded ${t.status==="Approved"?"bg-emerald-50 text-emerald-600":"bg-amber-50 text-amber-600"}`,children:t.status})]})]})]}),e.jsxs("div",{className:`text-sm font-black shrink-0 ${t.points>0?"text-emerald-500":"text-rose-500"}`,children:[t.points>0?"+":"",t.points]})]},t.id)),x.length===0&&e.jsxs("div",{className:"py-20 text-center bg-white dark:bg-slate-800 rounded-[3rem] border border-dashed border-slate-200 dark:border-slate-800",children:[e.jsx(U,{className:"w-12 h-12 text-slate-200 dark:text-slate-800 mx-auto mb-4"}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Belum ada catatan aktivitas."})]})]})]})]}):e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"bg-white dark:bg-[#151E32] p-5 rounded-[2.5rem] border border-slate-100 dark:border-slate-800 shadow-sm relative group overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-[0.03] rotate-12",children:e.jsx(w,{className:"w-32 h-32"})}),e.jsx("div",{className:"relative z-10 flex gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4.5 h-4.5 text-slate-400 group-focus-within:text-indigo-500 transition-colors"}),e.jsx("input",{type:"text",placeholder:"CARI PASAL TATA TERTIB...",value:P,onChange:t=>W(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-2xl py-4 pl-12 pr-4 text-[11px] font-black focus:ring-4 focus:ring-indigo-500/5 transition-all text-slate-800 dark:text-white outline-none shadow-inner"})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:q.map(t=>e.jsxs("div",{className:"bg-white dark:bg-[#151E32] p-5 rounded-[2rem] border border-slate-100 dark:border-slate-800 shadow-sm hover:shadow-md transition-all group flex flex-col justify-between min-h-[140px]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-md text-[7px] font-black uppercase tracking-widest ${t.points>=20?"bg-rose-50 text-rose-600":"bg-amber-50 text-amber-600"}`,children:t.category}),e.jsxs("span",{className:"text-[10px] font-black text-slate-300",children:["#",t.id]})]}),e.jsx("h4",{className:"text-[11px] font-bold text-slate-700 dark:text-slate-200 leading-relaxed group-hover:text-indigo-600 transition-colors",children:t.description})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-50 dark:border-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(w,{className:"w-3.5 h-3.5 text-slate-300"}),e.jsx("span",{className:"text-[8px] font-black text-slate-400 uppercase tracking-widest",children:"Aturan Resmi MAN 1 HST"})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-xl font-black text-rose-600",children:t.points}),e.jsx("span",{className:"text-[7px] font-black text-slate-400 uppercase tracking-tighter",children:"Poin"})]})]})]},t.id))})]}),e.jsx("div",{className:"p-8 bg-slate-50 dark:bg-slate-900/50 rounded-[2.5rem] border border-dashed border-slate-200 dark:border-slate-800 text-center",children:e.jsxs("p",{className:"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.2em] leading-relaxed",children:["Skor awal kredit disiplin adalah 100 poin. ",e.jsx("br",{}),"Pelanggaran mengurangi skor, sementara prestasi dan ketaatan ibadah menambah skor. ",e.jsx("br",{}),"Ambang batas sanksi: 75 (SP I), 50 (SP II), 25 (SP III)."]})})]}),G&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md",children:e.jsxs("div",{className:"bg-white dark:bg-[#0B1121] w-full max-w-lg rounded-[3rem] p-8 shadow-2xl animate-in zoom-in duration-300 border border-white/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-[0.03]",children:e.jsx(w,{className:"w-40 h-40"})}),e.jsxs("div",{className:"flex justify-between items-center mb-8 relative z-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-slate-800 dark:text-white uppercase leading-none",children:"Input Disiplin"}),e.jsx("p",{className:"text-[9px] font-bold text-indigo-500 uppercase mt-2",children:"Pelanggaran & Penghargaan"})]}),e.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(T,{className:"w-8 h-8 text-slate-400"})})]}),e.jsxs("form",{onSubmit:X,className:"space-y-6 relative z-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Pilih Siswa"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{required:!0,value:a.studentId,onChange:t=>h({...a,studentId:t.target.value}),className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl py-4 px-5 text-xs font-bold outline-none appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"-- CARI NAMA SISWA --"}),$.map(t=>e.jsxs("option",{value:t.id,children:[t.namaLengkap," (",t.tingkatRombel,")"]},t.id))]}),e.jsx(V,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Jenis Input"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>h({...a,type:"Violation"}),className:`py-3 rounded-xl border font-black text-[10px] uppercase tracking-widest transition-all ${a.type==="Violation"?"bg-rose-600 border-rose-600 text-white shadow-lg":"bg-slate-50 dark:bg-slate-900 border-slate-100 text-slate-400"}`,children:"Pelanggaran"}),e.jsx("button",{type:"button",onClick:()=>h({...a,type:"Reward"}),className:`py-3 rounded-xl border font-black text-[10px] uppercase tracking-widest transition-all ${a.type==="Reward"?"bg-emerald-600 border-emerald-600 text-white shadow-lg":"bg-slate-50 dark:bg-slate-900 border-slate-100 text-slate-400"}`,children:"Prestasi"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Pilih Aturan/Reward"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{required:!0,value:a.ruleId,onChange:t=>h({...a,ruleId:t.target.value}),className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl py-4 px-5 text-xs font-bold outline-none appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"-- PILIH DESKRIPSI --"}),D.filter(t=>a.type==="Violation"?t.points>0:t.points<0).map(t=>e.jsxs("option",{value:t.id,children:[t.description," (",Math.abs(t.points)," Poin)"]},t.id))]}),e.jsx(V,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-4 bg-indigo-600 text-white font-black rounded-[2rem] text-[10px] uppercase tracking-[0.3em] shadow-2xl shadow-indigo-500/30 flex items-center justify-center gap-3 active:scale-[0.98] transition-all",children:[e.jsx(Z,{className:"w-5 h-5"})," Simpan Catatan Disiplin"]})]})]})})]})},I=({label:S,value:n,icon:j,color:u,bg:b})=>e.jsxs("div",{className:`p-5 rounded-[2rem] border border-slate-100 dark:border-slate-800 shadow-sm flex flex-col justify-between min-h-[120px] ${b}/20`,children:[e.jsx("div",{className:`w-10 h-10 rounded-2xl flex items-center justify-center ${b} ${u} mb-3 shadow-sm`,children:e.jsx(j,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-2xl font-black text-slate-800 dark:text-white leading-none",children:n}),e.jsx("p",{className:"text-[8px] font-black text-slate-400 uppercase tracking-widest mt-1.5",children:S})]})]});export{se as default};
