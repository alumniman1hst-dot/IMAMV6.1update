import{i as u,d as m,r as n,j as e,S as l,a as p,a4 as b,m as f,c as x}from"./index-CcQVG4nr.js";import{L as k}from"./Layout-aA6jRwwe.js";const j="login_logs",w=async a=>{if(u){const t=localStorage.getItem("mock_login_history");return t?JSON.parse(t).filter(d=>d.userId===a||a==="mock-user-123"):[{id:"1",userId:a,timestamp:new Date().toISOString(),device:"Windows Desktop",status:"Success",ip:"192.168.1.1"},{id:"2",userId:a,timestamp:new Date(Date.now()-864e5).toISOString(),device:"Android Device",status:"Success",ip:"192.168.1.5"},{id:"3",userId:a,timestamp:new Date(Date.now()-1728e5).toISOString(),device:"Windows Desktop",status:"Success",ip:"192.168.1.1"}]}try{if(!m)throw new Error("Database not initialized");return(await m.collection(j).where("userId","==",a).orderBy("timestamp","desc").limit(20).get()).docs.map(i=>({id:i.id,...i.data()}))}catch(t){if(console.error("Error fetching login history:",t),t.code==="permission-denied"||t.message&&t.message.includes("Missing or insufficient permissions")){const i=localStorage.getItem("local_login_history_fallback");if(i)return JSON.parse(i)}return[]}},v=({onBack:a})=>{const[t,i]=n.useState([]),[d,h]=n.useState(!0);n.useEffect(()=>{(async()=>{var c;let r="mock-user-123";!u&&((c=x)!=null&&c.currentUser)&&(r=x.currentUser.uid);const g=await w(r);i(g),h(!1)})()},[]);const o=s=>{const r=new Date(s);return new Intl.DateTimeFormat("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(r)};return e.jsx(k,{title:"Riwayat Login",subtitle:"Aktivitas Masuk Akun",icon:l,onBack:a,children:e.jsx("div",{className:"p-4 lg:p-6 pb-24",children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-400",children:[e.jsx(p,{className:"w-8 h-8 animate-spin mb-3"}),e.jsx("p",{className:"text-sm font-medium",children:"Memuat riwayat..."})]}):t.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-xl p-4 mb-4 flex gap-3 items-start",children:[e.jsx(l,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 shrink-0"}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-300 leading-relaxed",children:"Berikut adalah daftar aktivitas login terakhir ke akun Anda. Jika Anda melihat perangkat yang tidak dikenal, segera ubah kata sandi Anda."})]}),t.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${s.status==="Success"?"bg-green-50 dark:bg-green-900/20 text-green-600":"bg-red-50 dark:bg-red-900/20 text-red-600"}`,children:e.jsx(b,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-slate-800 dark:text-white",children:s.device}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono",children:s.ip||"IP Hidden"}),e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-slate-100 dark:bg-slate-700 rounded text-slate-500",children:s.status})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 flex items-center justify-end gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),o(s.timestamp).split(",")[1]]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-0.5",children:o(s.timestamp).split(",")[0]})]})]},s.id))]}):e.jsxs("div",{className:"text-center py-20 bg-white dark:bg-slate-800 rounded-3xl border border-dashed border-slate-200 dark:border-slate-700",children:[e.jsx(l,{className:"w-12 h-12 text-slate-300 dark:text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Belum ada riwayat login tercatat."})]})})})};export{v as default};
